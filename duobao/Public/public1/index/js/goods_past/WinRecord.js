define(["require","$","pro","controller/BaseController","ui/SimpleHeader","action/BaseAction","common/Location","common/Utils","model/WinRecordModel","view/detail/WinRecordListView","ui/NumberInput"],function(e){function i(){var e=this;e._action=l.ajax("/win/getList.do",{gid:e._gid,pageSize:e._pageSize,pageNum:e._currPage},function(i){for(var t=i.result.list,n=0,o=t.length;o>n;n++){var r=t[n];r.owner?(r.status=3,r.owner.avatarSize=90):r.status=2,r.gid=e._gid,e._lastPeriod=t[n].period}e.renderList(i),e._currPage++,i.result.totalCnt>e._pageSize&&e.renderInput()})}function t(e){var i=this,t=r(".m-winRecord-wrap");t.find(".w-loading").hide(),i.list=new a.List(e.result.list,g),i.listView&&i.listView.hideMore(),i.listView=new w({list:i.list}).join(this).render(t[0]),i.listen(i.listView,"showmore",function(){i.listView.isLoading=!0,i.getList()}),e.result.pageNum<Math.ceil(e.result.totalCnt/e.result.pageSize)?i.listView.showMore():i.listView.noMore(),i.listView.listen("countdownfinish",function(e){l.ajax("/goods/getWinner.do",{gid:i._gid,period:e.model.get("period")},function(i){i.code-0==0?(i.result.status=3,e.update(i.result)):e.doms.waitingTxt.innerHTML='<span class="txt-gray">抱歉，服务器开小差了，请稍后重试...</span>'})}),i.listView.listen("@child:click",function(e){window.location.href=u.getGoodsUrl(e.model.get("gid"),e.model.get("period"))})}function n(){var e=this,i=r(".m-winRecord-period"),t=e._lastPeriod-1,n=(new m({value:t,min:1,max:window.TOTALPERIOD,onchange:function(){t=this.getValue()}}).join(this).render(i[0]),r(".m-winRecord-go"));n.show(),n.find(".w-button").bind("click",function(){window.location.href=u.getGoodsUrl(e._gid,t,!0)})}function o(){var e=this;e._gid=(c.getParam("gid")||0)-0,e._refer=c.getParam("refer"),r("#dvHeader").length>0&&s.by(a.$("dvHeader"),{back:""==e._refer?!0:e._refer,context:e}),e.getList()}var r=e("$"),a=e("pro"),d=e("controller/BaseController"),s=e("ui/SimpleHeader"),l=e("action/BaseAction"),c=e("common/Location"),u=e("common/Utils"),g=e("model/WinRecordModel"),w=e("view/detail/WinRecordListView"),m=e("ui/NumberInput");return d.extend(o,{},{getList:i,renderList:t,renderInput:n,_action:null,_pageSize:10,_currPage:1,_gid:0,_lastPeriod:0,_refer:""})});