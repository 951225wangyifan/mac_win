define(["require","$","pro","model/WinRecordModel","common/Countdown","ui/More"],function(e){function n(e){var n=this;n.winHeight=parseInt(document.documentElement.clientHeight)}var o=e("$"),i=e("pro"),t=e("model/WinRecordModel"),r=e("common/Countdown"),s=e("ui/More");return i.ListView.extend(n,{ItemView:i.View.extend(function(){this.listen("render",function(){var e=this;if(e.doms.countingTxt){var n=null;new r({now:G.serverTime,expires:e.model.get("remainTime"),listeners:{finish:function(){n=null,e.doms.countingTxt.style.display="none",e.doms.waitingTxt.style.display="inline-block",e.getParent().fire("countdownfinish",e)}}}).start()}})},{Model:t,_template:['{{#isCounting}}<li class="m-winRecord-willReveal">','<a href="{{gurl}}">期号：{{period}}　<span data-pro="countingTxt">即将揭晓，正在倒计时...</span><span data-pro="waitingTxt" class="txt-orange" style="display:none">请稍候，正在计算...</span></a></div>',"</li>{{/isCounting}}",'{{^isCounting}}<li class="w-record m-winRecord-revealed">','<div class="w-record-title"><a href="{{gurl}}">期号：{{period}} ( 揭晓时间：{{calcTime}} )</a></div>','<div class="w-record-cnt f-clear">','<div class="w-record-avatar"><a href="{{owner.userpage}}&refer=back">{{&owner.avatar}}</a></div>','<div class="w-record-detail">','<p class="f-txtabb">获奖者：<a href="{{owner.userpage}}&refer=back">{{owner.nickname}}</a></p>','<p class="f-txtabb"><span class="txt-green">( {{owner.IPAddress}} IP：{{owner.IP}} )</span></p>',"<p>用户ID：{{owner.cid}} (唯一不变标识)</p>",'<p>幸运号码：<span class="txt-red">{{luckyCode}}</span></p>','<p>本期参与：<span class="txt-red">{{cost}}</span>人次</p>',"</div>","</div>","</li>{{/isCounting}}"].join(""),_doms:{countingTxt:"@countingTxt",waitingTxt:"@waitingTxt"},_events:{"@":"click"}}),EmptyView:i.View.extend({_template:'<p class="status-empty">谁会是第一个幸运儿~</p>'}),_template:['<ul class="m-winRecord-list hahah" data-pro="entry"></ul><div data-pro="more"></div>'].join(""),_entry:"@entry"},{isLoading:!1,showMore:function(){var e=this;console.log(e.oMore),e.oMore&&e.oMore.destroy(),e.oMore=new s({onclick:function(){e.fire("moreclick")}}).join(e).render(e.find("@more")),e.bindScroll()},hideMore:function(){var e=this;e.oMore&&e.oMore.destroy(),o(window).off("scroll"),o(window).off("resize")},resetMore:function(){var e=this;e.oMore&&e.oMore.reset()},noMore:function(){var e=this;e.oMore&&e.oMore.disable()},bindScroll:function(){var e=this;o(window).on("scroll",function(){"none"!=e.oMore.doms.link.style.display&&e.scrollEvent()}),o(window).on("resize",function(){e.resizeEvent()})},scrollEvent:function(){var e=this,n=e.oMore.doms.link;if(n&&!e.isLoading){var o=n.getBoundingClientRect().top;e.winHeight-30>=o&&e.fire("showmore")}},resizeEvent:function(){var e=this;e.winHeight=parseInt(document.documentElement.clientHeight)}})});